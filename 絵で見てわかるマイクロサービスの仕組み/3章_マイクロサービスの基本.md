# マイクロサービスアーキテクチャの基本

## 3.1 サービスの構造
マイクロサービスにおけるサービスの構造は、他アーキテクチャと変わることはない。
ドメイン（問題領域）の解決/実装のため設けられるソフトウェアコンポーネントがサービス。

サービスは、ドメインの解決のために
・ビジネスロジック
・モデル
・クライアントにサービスを利用するためのインターフェース（API）
を提供します。

モデルは、データベースに登録されているビジネスデータを指します。
マイクロサービスでは、サービスを介してデータベースに格納されているデータにアクセスします。

マイクロサービスでは、不特定多数のアプリケーションからデータベースを共有するような設計はしない。

## 3.2 レイヤードアーキテクチャ
割愛

### 3.2.1 制御の逆転
レイヤードアーキテクチャには、抽象が具象に依存しているため「拡張性に乏しい」という欠点がある
ソフトウェアコンポーネントが基盤実装に依存しているため、
通信プロトコルやデータベースなどの基盤実装に変更が入るとユーザーインターフェースや
アプリケーションにも影響し、プログラム修正が必要になります。

レイヤードアーキテクチャは、プログラムはそのままに、基盤を新しい実装に置き換えるという
拡張性の視点が欠けているのです。

そのため、制御の逆転(IoC)という考え方があります。
IoCを取り入れたアーキテクチャとしてヘキサゴナルアーキテクチャがあります。

## 3.3 ヘキサゴナルアーキテクチャ
ヘキサゴナルアーキテクチャは、不特定の入出力機能対応への拡張性を特徴とするアーキテクチャです。
ドメイン（ビジネスロジック）を中心に、ドメインを呼び出す入力元と、ドメインが働きかける出力先が取り囲んでいます。

ヘキサゴナルアーキテクチャの強みは外部入出力とドメインの中間に位置する「ポート&アダプター」にあります。
アダプターは、
外部機能とやり取りするための実装を提供し、外部機能ごとに置き換えられます。
ポートは、
抽象化されたプログラミングインターフェースをドメインに提供するもの
ドメイン内で、ポートを介して外部機能にアクセスする実装にしておけば、
外部機能を置き換えもドメインは影響を受けません。

## 3.4 データベースアクセス
マイクロサービスでは、サービスはモデル（ビジネスデータ）を包含します。
例として、とあるサービスが自身の管理外のモデルにアクセスする場合、そのモデルを包含している
他サービスを介して、データアクセスします。

そのため、複数のサービスが1つのデータベースを共有し、直接アクセスすることは推奨されません。

## 3.5 トランザクション管理
マイクロサービスでは、原則、ローカルトランザクションの利用を推奨しています。

ローカルトランザクションとは、
1つのトランザクションコンテキストの中で処理対象のリソース（データベースやメッセージオリエンテッドミドルウェアなど）
を1つに限定するタイプのトランザクションのことです。

## 3.6 データベース間の同期
マイクロサービスの推奨に従ってモデリングすると、
アプリケーションだけでなくデータベースも分散配置された、
超分散コンピューティング環境となります。

データベースの同期はSagaで解決する
Sagaとは、ローカルトランザクション、イベント、補償トランザクションといった技術を駆使して、
複数のリソース間で同期を取るデザインパターンです。


4.2.3まで
















