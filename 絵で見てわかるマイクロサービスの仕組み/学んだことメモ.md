# クラウドネイティブコンピューティングとマイクロサービス
## 2.1.2 クラウドサービスモデル
### マイクロサービスとは
基盤構築のスピード感に合わせて、アプリケーション開発とメンテナンス（変更）を、
タイムリーに素早くするための設計/開発/運用手法をまとめたものです。
その中心となるのはソフトウェア構造で、サービスを独立して開発/稼働されるように実装し、
それらを組み合わせることで1つのアプリケーションを表現する。

## 2.2 クラウドネイティブコンピューティング
クラウドネイティブコンピューティングの目的は、
スケーラブルなアプリケーションを構築/運用すること、
そしてITシステムに対して、最小限の工数で頻繁かつ予測通りに
インパクトのある変更を加えることにある。

具体的な方法としては、「コンテナ」「サービスメッシュ」「マイクロサービス」
「イミュータブルインフラストラクチャ」「宣言型API」を活用する。

クラウドネイティブコンピューティングに関連するテクノロジーを整理、分類して
全体を把握する
・基盤(Platform)
・オーケストレーション(Orchestration & management)
・アプリケーション基盤(Runtime)
・アプリケーション開発(App Definition and Development)
・運用監視/分析(Observatory and Analysis)
・サーバーレス

## 2.3.2 コンテナオーケストレーション
1つのアプリケーションをマイクロサービスとして設計した場合、
・複数のサービスから構成される
・複数のコンテナで支えるモデルになる

つまり、管理するクラスターメンバー（コンテナ）の数が格段に増えることになる
そのため、コンテナオーケストレーションを利用することになる

コンテナオーケストレーションには、主に以下の機能が備わっている
・コンテナクラスターの管理/運用
・コンテナクラスターのデプロイ
・名前解決
・ルーティング
・サービスディスカバリ
・ロードバランシング
・スケーラビリティ
・障害時のセルフヒーリング

## 2.3.3 DevOps
DevOpsとは、開発チームと運用チームの連携によって、
スピーディ、高頻度、そして確実なITシステムの開発とテストリリースを目指すプラクティスのこと

DevOpsに標準的な定義はないが、以下の2種類がある
・IT関連組織に的を絞った狭義のDevOps
・事業部門（ユーザー部門）や一般消費者（エンドユーザー）まで対象を広げた広義のDevOps

広義のDevOpsでは、
事業部門の立案する戦略/計画と、ITシステム開発/運用
一般消費者のリアクションを密に連携させてエコシステムを確立し、
高頻度かつスピーディにフィードバックループを回すことで
ビジネス目標の達成とビジネス成果の最大化を狙います。

DevOpsで取り組むべき「手法」を実装するのがアジャイル開発プロセスになります。

DevOpsによるカルチャー変革の中で、「手法」を対象に適用されるべきものがアジャイル開発プロセスであり、
「効率化」のために活用される技術がCDのデリバリーパイプラインとなる

## 2.3.4 クラウドネイティブコンピューティングを進める理由
クラウドネイティブコンピューティングの中核をなす、
コンテナ、オーケストレーション、マイクロサービス、DevOpsを推奨する理由は3つある

・ITシステム開発/運用のスピードアップと品質向上
　→コンテナとオーケストレーションを基盤に採用することで、基盤構築をスピードアップすることができます。
・スケーラビリティと高可用性
　→Kubernetesなどのオーケストレーションフレームワークを活用すれば、
　　コンテナアプリケーションのクラスターを容易に作成し管理することが出来ます。
　　また、パブリッククラウドとインプレミス(プライベートクラウド)にまたがったハイブリッドクラウド環境に構築も可能で
　　ロードバランシング、スケーラビリティ、セルフヒーリングといった機能により、本番運用に耐えうるスケーラビリティと高可用性を実現出来ます。
・投資の保護
　→オーケストレーションフレームワークは、メジャーなクラウドサービスプロバイダやクラウド関連製品によってサポートされています。
　　そのため、一度コンテナアプリケーションを作成しておけば、最小限の修正で、容易に他のクラウドサービスプロバイダが提供するプラットフォームに移行することが可能で、
　　かつ複数のクラウドサービスに跨ったマルチクラウド環境も比較的容易に構築出来ます。

## 2.4.1 マイクロサービスアーキテクチャ
マイクロサービスアーキテクチャの中核は、サービスと呼ばれる独立して開発されて稼働するソフトウェアコンポーネントを、
複数組み合わせることで1つのアプリケーションを構成するソフトウェア構造にある。

この構造を実現するに当たり、以下の技術、手法を用いる
【技術】
・コンテナ
・オーケストレーション
・REST
・メッセージング

【手法】
・DevOps
・アジャイル開発プロセス
・CD
・ドメイン駆動設計

マイクロサービスアーキテクチャで構築されたアプリケーションでは、
各サービスでRESTやメッセージングで通信し、1つのリクエストを処理する

【メリット】
細粒度のソフトウェア構造という特徴から、
アプリケーション全体を一度にリリースするビッグバン型手法ではなく、
アプリケーションの一部を段階的にリリース、変更する柔軟性を提供する
また、スケールアウトやスケールインにあたり、リクエストが集中しているサービスのみを拡張・縮小することも可能にし、
システムリソースの最適利用、稼働率改善に寄与します。

さらにサーキットブレーカーと組み合わせれば、障害の影響範囲を局所化（障害影響を1サービス、1リクエスト内に止める）することも可能

このような再粒度のソフトウェア構造はCDによる高頻度デリバリーにマッチしています。

【デメリット】
1ユーザーリクエストを処理する都度、サービス間通信が発生する可能性があるため、パフォーマンスに影響します。
また、アプリケーションだけでなくデータも分散配置されるため、DB間の整合性や同期の手法、運用/監視の仕組みを整備しなければなりません。

さらに、サービスモデリング手法の学習コストと、各サービスを包含するシステム全体の設計の整合性に配慮する必要もあります。

## 2.5 マイクロサービスの特徴
### 2.5.1 サービスによるコンポーネント設計
マイクロサービスでは、サービスによるコンポーネント化を推奨しています。
独立したコンテナ上にデプロイされて稼働するサービスは、
個別に置き換えることが可能なため、アプリケーションの変更が容易で、
かつスケール調整が出来るから

マイクロサービスでのサービス間通信には、軽量でシンプルな通信手段を用います。
例）RESTや軽量なメッセージング
注）メッセージングエンジンとしてESBを利用する場合、メッセージング用途でのみ用いること
　　メデュエーションというメッセージング処理の過程で、メッセージ変換、ルーティング、他任意の処理を加える機能があるが、
　　複雑で不具合の原因となる可能性があるため推奨されていない

### 2.5.2
1つのサービスが責務を負うビジネス機能の単位で、開発/運用チームを編成することを推奨しています。
マイクロサービスでは、独立してメンテナンス可能なサービスを作成することあります。

そのため、チームは自律して開発/運用を進めれるように構成します。
チーム規模は小さく抑えつつ、
・ユーザーインターフェースのデザイナー、
・アプリケーション開発エンジニア
・DBスペシャリスト
・運用を担うサイトリライアビリティエンジニア
などのメンバーを揃えます。

### 2.5.3
マイクロサービスでは、プログラミング言語やデータベースの選定を、各開発/運用チームに委ねます。

そのため、開発環境と永続データストアは、プロジェクトによる中央集権ではなく、各チームによる分散統治となる

### 2.5.4 基盤に対する考慮
マイクロサービスでは、開発リリース、メンテナンスのスピードアップと促し、
かつオペレーションミスを減らすため、CDを推奨しています。

マイクロサービスでは、障害発生を前提に設計します。
各サービスがログ/トレース機能を実装することはもちろんのこと、
サーバーやネットワークも含めたメトリクスを監視し、タイムリーな障害検知と対応に備えます。

## 2.6 マイクロサービスにおける開発/運用の流れ
アジャイル開発のプロセスを適用することが推奨されていますが、
他は以下の通り、他アーキテクチャスタイルの場合とほぼ同じ。
・ドメイン分析
　(ITシステム開発対象であるビジネス領域の分析と要件の洗い出し)
・設計
・開発
・リリース
・運用

## 2.7 マイクロサービスの適用基準
マイクロサービスも万能薬ではない。
マイクロサービスに向いているシステムもあれば不向きのものもある。

マイクロサービスには、以下の取り組みが必要になる
・従来とは一風変わった組織体制
・アジャイル開発プロセスの実践
・ドメイン分析とサービスモデリング
・基盤構築の自動化
・分散システム開発の運用監視
・分散配置されたデータベースの同期

上記に取り組むほどの意味のあるシステムとは、大規模で複雑なシステムです。
・大規模なビジネスぢメインのデジタル化
・100名規模の大規模開発チーム
・複数システムの統合
などのような、大規模/複雑なシステム開発を、整合性を保ちつつ管理・運用することは大変です。
上記のようなケースであれば、ドメイン（対象領域）を分割し、 それぞれを独自に開発/運用する
マイクロサービスが向いています。




3.7.1まで























